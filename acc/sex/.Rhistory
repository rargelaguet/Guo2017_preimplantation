)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm") +
# geom_segment(aes(x=opts$xmin, xend=opts$xmax, y=0, yend=0), size=0.25, color="orange") +
# geom_segment(aes(x=0, xend=0, y=opts$ymin, yend=opts$ymax), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_classic() +
theme(
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm") +
# geom_segment(aes(x=opts$xmin, xend=opts$xmax, y=0, yend=0), size=0.25, color="orange") +
# geom_segment(aes(x=0, xend=0, y=opts$ymin, yend=opts$ymax), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_classic() +
theme(
legend.position = "none"
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm") +
# geom_segment(aes(x=opts$xmin, xend=opts$xmax, y=0, yend=0), size=0.25, color="orange") +
# geom_segment(aes(x=0, xend=0, y=opts$ymin, yend=opts$ymax), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_classic() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm") +
# geom_segment(aes(x=opts$xmin, xend=opts$xmax, y=0, yend=0), size=0.25, color="orange") +
# geom_segment(aes(x=0, xend=0, y=opts$ymin, yend=opts$ymax), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
# geom_segment(aes(x=opts$xmin, xend=opts$xmax, y=0, yend=0), size=0.25, color="orange") +
# geom_segment(aes(x=0, xend=0, y=opts$ymin, yend=opts$ymax), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
scale_colour_viridis_c() +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
# geom_segment(aes(x=opts$xmin, xend=opts$xmax, y=0, yend=0), size=0.25, color="orange") +
# geom_segment(aes(x=0, xend=0, y=opts$ymin, yend=opts$ymax), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
scale_fill_viridis_c() +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
# geom_segment(aes(x=opts$xmin, xend=opts$xmax, y=0, yend=0), size=0.25, color="orange") +
# geom_segment(aes(x=0, xend=0, y=opts$ymin, yend=opts$ymax), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
diff.results
ylim <- c(min(diff.results$acc), max(diff.results$acc))
max(diff.results$acc)
ylim <- c(min(diff.results$diff_acc), max(diff.results$diff_acc))
ylim
xlim <- c(min(diff.results$diff_met), max(diff.results$diff_met))
xlim
opts$xlim <- c(min(diff.results$diff_met), max(diff.results$diff_met))
opts$ylim <- c(min(diff.results$diff_acc), max(diff.results$diff_acc))
to.plot <- diff.results[comparison==i]
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
# scale_fill_viridis_c() +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
geom_segment(aes(x=opts$xmin, xend=opts$xmax, y=0, yend=0), size=0.25, color="orange") +
geom_segment(aes(x=0, xend=0, y=opts$ymin, yend=opts$ymax), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
p
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
# scale_fill_viridis_c() +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
geom_segment(aes(x=opts$xlim[1], xend=opts$xlim[2], y=0, yend=0), size=0.25, color="orange") +
geom_segment(aes(x=0, xend=0, y=opts$ylim[1], yend=opts$ylim[2]), size=0.25, color="orange") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
# scale_fill_viridis_c() +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
geom_segment(aes(x=opts$xlim[1], xend=opts$xlim[2], y=0, yend=0), size=0.25, color="gray60") +
geom_segment(aes(x=0, xend=0, y=opts$ylim[1], yend=opts$ylim[2]), size=0.25, color="gray60") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/volcano_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
io$outdir
for (i in unique(diff.results$comparison)) {
to.plot <- diff.results[comparison==i]
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
# scale_fill_viridis_c() +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
geom_segment(aes(x=opts$xlim[1], xend=opts$xlim[2], y=0, yend=0), size=0.25, color="gray60") +
geom_segment(aes(x=0, xend=0, y=opts$ylim[1], yend=opts$ylim[2]), size=0.25, color="gray60") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
png(sprintf("%s/differential_metacc_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
dev.off()
}
#############################################################################
## Script to plot the results from the differential methylation analysis ##
#############################################################################
library(data.table)
library(purrr)
library(ggplot2)
library(RColorBrewer)
# source("/Users/ricard/human_embryo_multiomics/met/differential/feature_level/analysis/utils.R")
#####################
## Define settings ##
#####################
## I/O ##
io <- list()
io$met.dir <- "/Users/ricard/data/human_embryo_multiomics/met/differential/feature_level"
io$acc.dir <- "/Users/ricard/data/human_embryo_multiomics/acc/differential/feature_level"
io$outdir <- "/Users/ricard/data/human_embryo_multiomics/metacc/differential"
dir.create(io$outdir, showWarnings = F)
## Options ##
opts <- list()
opts$comparisons <- c(
# "E56ICM_vs_E56TE",
# "E5ICM_vs_E5TE",
"E6ICM_vs_E6TE"
)
# Select genomic contexts
opts$annos <- c(
"genebody",
# "prom_200_200_cgi",
# "prom_200_200_noncgi",
# "prom_200_200",
"prom_2000_2000",
# "prom_2000_2000_cgi",
# "prom_2000_2000_noncgi",
"H1_H3K27ac",
"H1_H3K27me3",
"H1_H3K4me1",
"H1_H3K4me3"
)
# Minimum differential levels (%) for statistical significance
opts$min.diff <- 25
# Multiple testing correction
opts$threshold_fdr <- 0.10
###############
## Load data ##
###############
# Load precomputed differential DNA methylation results
diff.results.met <- lapply(opts$comparisons, function(i)
lapply(opts$annos, function(j)
fread(sprintf("%s/%s_%s.txt.gz",io$met.dir,i,j)) %>% .[,anno:=as.factor(j)]
) %>% rbindlist %>% .[,comparison:=i]
) %>% rbindlist %>% .[complete.cases(.)] %>%
.[,c("id","diff","sig","anno","comparison")] %>%
.[,context:=as.factor("diff_met")]
# Load precomputed differential chromatin accessibility results
diff.results.acc <- lapply(opts$comparisons, function(i)
lapply(opts$annos, function(j)
fread(sprintf("%s/%s_%s.txt.gz",io$acc.dir,i,j)) %>% .[,anno:=as.factor(j)]
) %>% rbindlist %>% .[,comparison:=i]
) %>% rbindlist %>% .[complete.cases(.)] %>%
.[,c("id","diff","sig","anno","comparison")] %>%
.[,context:=as.factor("diff_acc")]
# Select statistically significant hits
# diff.results.[,sig:=(padj_fdr<=opts$threshold_fdr & abs(diff)>opts$min.diff)]
################
## Parse data ##
################
diff.results <- rbind(diff.results.met,diff.results.acc) %>%
dcast(id+anno+comparison~context, value.var="diff") %>%
.[complete.cases(.)]
###################
## Scatter plots ##
###################
opts$xlim <- c(min(diff.results$diff_met), max(diff.results$diff_met))
opts$ylim <- c(min(diff.results$diff_acc), max(diff.results$diff_acc))
for (i in unique(diff.results$comparison)) {
to.plot <- diff.results[comparison==i]
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
# geom_point(size=0.8) +
geom_bin2d(bins=100) +
# scale_fill_viridis_c() +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
geom_segment(aes(x=opts$xlim[1], xend=opts$xlim[2], y=0, yend=0), size=0.25, color="gray60") +
geom_segment(aes(x=0, xend=0, y=opts$ylim[1], yend=opts$ylim[2]), size=0.25, color="gray60") +
# ggrepel::geom_text_repel(data=to.label.i, aes(x=diff_met, y=diff_acc, label=gene), size=5, color=opts$colors[i]) +
# coord_cartesian(xlim=c(opts$xmin,opts$xmax), ylim=c(opts$ymin,opts$ymax)) +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
png(sprintf("%s/differential_metacc_%s.png",io$outdir,i), width=8, height=8, units="in", res=400)
print(p)
dev.off()
}
png(sprintf("%s/differential_metacc_%s.png",io$outdir,i), width=10, height=10, units="in", res=400)
print(p)
dev.off()
head(diff.results)
diff.results <- rbind(diff.results.met,diff.results.acc) %>%
dcast(id+anno+comparison~context, value.var=c("diff","sig")) %>%
.[complete.cases(.)]
head(diff.results)
dim(diff.results[sig_diff_met | sig_diff_acc])
# Select differential hits
diff.results <- diff.results[sig_diff_met | sig_diff_acc]
opts$xlim <- c(min(diff.results$diff_met), max(diff.results$diff_met))
opts$ylim <- c(min(diff.results$diff_acc), max(diff.results$diff_acc))
for (i in unique(diff.results$comparison)) {
to.plot <- diff.results[comparison==i]
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
geom_bin2d(bins=100) +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
geom_segment(aes(x=opts$xlim[1], xend=opts$xlim[2], y=0, yend=0), size=0.25, color="gray60") +
geom_segment(aes(x=0, xend=0, y=opts$ylim[1], yend=opts$ylim[2]), size=0.25, color="gray60") +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/differential_metacc_%s.png",io$outdir,i), width=10, height=10, units="in", res=400)
print(p)
# dev.off()
}
#############################################################################
## Script to plot the results from the differential methylation analysis ##
#############################################################################
library(data.table)
library(purrr)
library(ggplot2)
library(RColorBrewer)
# source("/Users/ricard/human_embryo_multiomics/met/differential/feature_level/analysis/utils.R")
#####################
## Define settings ##
#####################
## I/O ##
io <- list()
io$met.dir <- "/Users/ricard/data/human_embryo_multiomics/met/differential/feature_level"
io$acc.dir <- "/Users/ricard/data/human_embryo_multiomics/acc/differential/feature_level"
io$outdir <- "/Users/ricard/data/human_embryo_multiomics/metacc/differential"
dir.create(io$outdir, showWarnings = F)
## Options ##
opts <- list()
opts$comparisons <- c(
# "E56ICM_vs_E56TE",
# "E5ICM_vs_E5TE",
"E6ICM_vs_E6TE"
)
# Select genomic contexts
opts$annos <- c(
"genebody",
# "prom_200_200_cgi",
# "prom_200_200_noncgi",
# "prom_200_200",
"prom_2000_2000",
# "prom_2000_2000_cgi",
# "prom_2000_2000_noncgi",
"H1_H3K27ac",
"H1_H3K27me3",
"H1_H3K4me1",
"H1_H3K4me3"
)
# Minimum differential levels (%) for statistical significance
# opts$min.diff <- 15
# Multiple testing correction
# opts$threshold_fdr <- 0.10
###############
## Load data ##
###############
# Load precomputed differential DNA methylation results
diff.results.met <- lapply(opts$comparisons, function(i)
lapply(opts$annos, function(j)
fread(sprintf("%s/%s_%s.txt.gz",io$met.dir,i,j)) %>% .[,anno:=as.factor(j)]
) %>% rbindlist %>% .[,comparison:=i]
) %>% rbindlist %>% .[complete.cases(.)] %>%
.[,c("id","diff","sig","anno","comparison")] %>%
.[,context:=as.factor("met")]
# Load precomputed differential chromatin accessibility results
diff.results.acc <- lapply(opts$comparisons, function(i)
lapply(opts$annos, function(j)
fread(sprintf("%s/%s_%s.txt.gz",io$acc.dir,i,j)) %>% .[,anno:=as.factor(j)]
) %>% rbindlist %>% .[,comparison:=i]
) %>% rbindlist %>% .[complete.cases(.)] %>%
.[,c("id","diff","sig","anno","comparison")] %>%
.[,context:=as.factor("acc")]
diff.results <- rbind(diff.results.met,diff.results.acc) %>%
dcast(id+anno+comparison~context, value.var=c("diff","sig")) %>%
.[complete.cases(.)]
# Select differential hits
diff.results <- diff.results[sig_diff_met | sig_diff_acc]
# Select differential hits
diff.results <- diff.results[sig_met | sig_acc]
#############################################################
## Scatter plots of diffmet vs diffacc per genomic context ##
#############################################################
opts$xlim <- c(min(diff.results$diff_met), max(diff.results$diff_met))
opts$ylim <- c(min(diff.results$diff_acc), max(diff.results$diff_acc))
for (i in unique(diff.results$comparison)) {
to.plot <- diff.results[comparison==i]
p <- ggplot(to.plot, aes(x=diff_met, y=diff_acc)) +
geom_bin2d(bins=100) +
facet_wrap(~anno, scales="fixed") +
geom_smooth(method="lm", color="red") +
geom_segment(aes(x=opts$xlim[1], xend=opts$xlim[2], y=0, yend=0), size=0.25, color="gray60") +
geom_segment(aes(x=0, xend=0, y=opts$ylim[1], yend=opts$ylim[2]), size=0.25, color="gray60") +
labs(x="Differential methylation (%)", y="Differential accessibility (%)") +
theme_pubr() +
theme(
legend.position = "none",
axis.text = element_text(size=rel(1.1), color="black"),
axis.title = element_text(size=rel(1.2), color="black")
)
# pdf(sprintf("%s/volcano_%s_%s.pdf",io$outdir,i,j), width=7, height=5)
# png(sprintf("%s/differential_metacc_%s.png",io$outdir,i), width=10, height=10, units="in", res=400)
print(p)
# dev.off()
}
if (grepl("ricard",Sys.info()['nodename'])) {
source("/Users/ricard/human_embryo_multiomics/settings.R")
} else {
stop("Computer not recognised")
}
# Folders with the differential analysis results
io$diff.met <- paste0(io$basedir,"/met/differential/feature_level")
# Output directory
io$outdir <- paste0(io$basedir,"/met/variability/boxplots")
# Define stage and lineages
opts$stage_lineage <- c(
"E3_Prelineage",
"E4_Prelineage",
"E5_ICM",
"E5_TE",
"E6_ICM",
"E6_TE"
)
# Define genomic contexts for methylation
opts$met.annos <- c(
# "genebody" = "Genebodies",
"prom_2000_2000" = "Promoters",
"H1_H3K27ac" = "hESCs H3K27ac",
"H1_H3K4me3" = "hESCs H3K4me3",
"H1_H3K4me1" = "hESCs H3K4me1"
)
# Options for selecting differential hits
opts$min.fdr <- 0.10
opts$min.met.diff <- 25
# Update metadata
sample_metadata <- sample_metadata %>%
.[,stage_lineage:=paste(stage,lineage,sep="_")] %>%
.[stage_lineage%in%opts$stage_lineage]
opts$met_cells <- sample_metadata %>% .[!is.na(id_met) & pass_metQC==T,id_met]
opts$acc_cells <- sample_metadata %>% .[!is.na(id_acc) & pass_accQC==T,id_acc]
opts$met_cells
opts$met_cells <- sample_metadata %>% .[!is.na(id_met) & pass_metQC==T,id_met] %>% as.character
opts$acc_cells <- sample_metadata %>% .[!is.na(id_acc) & pass_accQC==T,id_acc] %>% as.character
opts$met_cells
if (grepl("ricard",Sys.info()['nodename'])) {
source("/Users/ricard/human_embryo_multiomics/met/variability/boxplots/load_settings.R")
# source("/Users/ricard/human_embryo_multiomics/metacc/boxplots/utils.R")
} else {
stop("Computer not recognised")
}
# Size of figures
# opts$width = 10
# opts$height = 5
met_dt <- lapply(names(opts$met.annos), function(n) {
fread(
file = sprintf("%s/%s.tsv.gz",io$met_data_parsed,n),
showProgress = F, header = F,
select = c("V1"="factor","V2"="character","V3"="factor","V4"="integer","V5"="integer","V6"="integer")
) %>% .[V1%in%opts$met_cells] %>% droplevels
}) %>% rbindlist %>% setnames(c("id_met","id","anno","Nmet","Ntotal","rate"))
Sys.getenv("R_LIBS_USER")
Sys.getenv()
